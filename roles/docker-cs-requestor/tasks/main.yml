- name: create certs directory
  file:
    path: "{{ docker_connect_certs_path }}"
    state: directory

- name: generate csr on server
  command: "openssl req -subj '/CN={{ inventory_hostname }}' -sha256 -new -newkey rsa:4096 -keyout {{ docker_connect_certs_path }}/server-key.pem -nodes -out {{ docker_connect_certs_path }}/server.csr"

- name: generate local client csr on server
  command: "openssl req -subj '/CN=localhost' -sha256 -new -newkey rsa:4096 -keyout {{ docker_connect_certs_path }}/key.pem -nodes -out {{ docker_connect_certs_path }}/client.csr"
